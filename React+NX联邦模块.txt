React+NXè”é‚¦æ¨¡å—
2025 å¹´ 2 æœˆ 24 æ—¥â€¢å†…å®¹ç”± AI ç”Ÿæˆï¼Œä¸èƒ½å®Œå…¨ä¿éšœçœŸå®
å†™å‡ºè¯¦ç»†çš„ä»£ç ï¼Œå…¶ä¸­remote appå’Œsheâ€™ll appéƒ½æ˜¯react å†™çš„ï¼Œremote appåŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼Œsearchå’Œdetailé¡µé¢ï¼Œsearché¡µé¢ä¸­æœ‰ä¸ªid è¾“å…¥æ¡†ï¼Œè¾“å…¥id ådetailé¡µé¢èƒ½æ˜¾ç¤ºå…¶å…·ä½“ä¿¡æ¯idğŸŸ°5ï¼Œage ğŸŸ°15ï¼Œname=robby ï¼Œå°†è¿™ä¸¤ä¸ªé¡µé¢ç»„ä»¶éƒ½exposeç»™shell appï¼Œä½¿ç”¨nx federation
ä»¥ä¸‹æ˜¯ç»“åˆ NX Module Federation å®ç° Remote App å’Œ Shell App è¿æ¥çš„è¯¦ç»†ä»£ç ç¤ºä¾‹ï¼Œå‡è®¾ Remote App æš´éœ²Searchå’ŒDetailç»„ä»¶ï¼ŒShell App åŠ è½½å¹¶ä½¿ç”¨å®ƒä»¬ï¼š
1. åˆ›å»º Remote Appï¼ˆremote - appï¼‰
å®‰è£…ä¾èµ–
ç¡®ä¿é¡¹ç›®ä¸­å·²ç»å®‰è£…äº†@angular - architects/module - federationï¼š
bash
npm install @angular - architects/module - federation --save - dev
é…ç½®module - federation.config.ts
typescript
const { withModuleFederationPlugin } = require('@angular - architects/module - federation/webpack');

module.exports = withModuleFederationPlugin({
  name:'remoteApp',
  exposes: {
    './Search': './src/app/search/search.tsx',
    './Detail': './src/app/detail/detail.tsx'
  },
  shared: {
    react: {
      singleton: true,
      requiredVersion: false
    },
   'react - dom': {
      singleton: true,
      requiredVersion: false
    }
  }
});
åˆ›å»ºSearchç»„ä»¶ï¼ˆsrc/app/search/search.tsxï¼‰
jsx
import React, { useState } from'react';

const Search = () => {
  const [id, setId] = useState('');

  return (
    <div>
      <input
        type="text"
        placeholder="è¾“å…¥id"
        value={id}
        onChange={(e) => setId(e.target.value)}
      />
    </div>
  );
};

export default Search;
åˆ›å»ºDetailç»„ä»¶ï¼ˆsrc/app/detail/detail.tsxï¼‰
jsx
import React from'react';

const Detail = ({ id }) => {
  const data = {
    id: 5,
    age: 15,
    name: 'robby'
  };
  return (
    <div>
      {id == data.id && (
        <div>
          <p>ID: {data.id}</p>
          <p>Age: {data.age}</p>
          <p>Name: {data.name}</p>
        </div>
      )}
    </div>
  );
};

export default Detail;
2. åˆ›å»º Shell Appï¼ˆshell - appï¼‰
é…ç½®module - federation.config.ts
typescript
const { withModuleFederationPlugin } = require('@angular - architects/module - federation/webpack');

module.exports = withModuleFederationPlugin({
  name:'shellApp',
  remotes: {
    remoteApp: 'http://localhost:4201/remoteEntry.js'// Remote Appè¿è¡Œåœ°å€ï¼Œç«¯å£æ ¹æ®å®é™…è°ƒæ•´
  },
  shared: {
    react: {
      singleton: true,
      requiredVersion: false
    },
   'react - dom': {
      singleton: true,
      requiredVersion: false
    }
  }
});
åœ¨ Shell App ä¸­ä½¿ç”¨ Remote App ç»„ä»¶ï¼ˆsrc/App.tsxï¼‰
jsx
import React, { useState, useEffect, Suspense } from'react';

const loadRemoteModule = async (remoteName, exposedModule) => {
  const script = document.createElement('script');
  script.src = `${process.env.NX_PUBLIC_REMOTE_APP_URL}/remoteEntry.js`;
  script.async = true;
  document.head.appendChild(script);

  const factory = window[remoteName].get(exposedModule);
  const Module = await factory();
  return Module.default;
};

const Search = React.lazy(() => loadRemoteModule('remoteApp', './Search'));
const Detail = React.lazy(() => loadRemoteModule('remoteApp', './Detail'));

const App = () => {
  const [id, setId] = useState('');
  const [loadedDetail, setLoadedDetail] = useState(false);

  useEffect(() => {
    if (id) {
      setLoadedDetail(true);
    } else {
      setLoadedDetail(false);
    }
  }, [id]);

  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <Search onChange={(e) => setId(e.target.value)} />
        {loadedDetail && <Detail id={Number(id)} />}
      </Suspense>
    </div>
  );
};

export default App;
3. è¿è¡Œå’Œæµ‹è¯•
å¯åŠ¨ Remote Appï¼šnx serve remote - appï¼Œè¿è¡Œåœ¨é»˜è®¤ç«¯å£ï¼ˆå¦‚ 4201ï¼‰ã€‚
å¯åŠ¨ Shell Appï¼šnx serve shell - appï¼Œè®¿é—® Shell App åœ°å€ï¼Œåœ¨ Search ç»„ä»¶çš„è¾“å…¥æ¡†ä¸­è¾“å…¥5ï¼ŒDetail ç»„ä»¶ä¼šæ˜¾ç¤ºå¯¹åº”ä¿¡æ¯ã€‚
æ³¨æ„äº‹é¡¹ï¼š
ç¡®ä¿process.env.NX_PUBLIC_REMOTE_APP_URLé…ç½®æ­£ç¡®ï¼ŒæŒ‡å‘ Remote App çš„è¿è¡Œåœ°å€ã€‚
ä»£ç ä¸­çš„ç«¯å£å·ç­‰é…ç½®éœ€æ ¹æ®å®é™…é¡¹ç›®è¿è¡Œæƒ…å†µè°ƒæ•´ ã€‚